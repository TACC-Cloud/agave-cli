#!/usr/bin/env python
"""
    tenants-init [OPTION]...

Configure the context of the cli by selecting the tenant and setting the base 
url.

Options:
    -t, --tenant            The tenant id to use, ex iplantc.org
"""
from __future__ import print_function
import argparse
import os
import sys
from agavepy.agave import Agave

parser = argparse.ArgumentParser(
    description="Configure the cli context by choosing a tenant to interact with"
)

parser.add_argument("-t", "--tenant", help="URL of Agave central service.")

parser.add_argument(
    "-c",
    "--cachedir",
    default=os.path.expanduser("~/.agave"),
    help="Directory to save confiurations in.")

if __name__ == "__main__":
    args = parser.parse_args()

    # Set tenant ID and url.
    try:
        if args.tenant is None:
            agave = Agave()
        else:
            agave = Agave(tenant_id=args.tenant)
    except KeyError:
        print("Error setting tenant", file=sys.stderr)
        os.Exit(1)

    # Save Agave configurations to cache dir.
    if args.cachedir is None:
        agave.save_configs()
    else:
        agave.save_configs(args.cachedir)

    msg = """
    Your CLI is now configured to interact with the Agave API for tenant {tenant}. 
    Use 'clients-create' to create a new Oauth client for the tenant or 
    'auth-tokens-create' to re-use an existing API key and secret.
    """
    print(msg.format(tenant=agave.tenant_id))
